/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java Library project to get you started.
 * For more details take a look at the Java Libraries chapter in the Gradle
 * User Manual available at https://docs.gradle.org/6.0.1/userguide/java_library_plugin.html
 */


plugins {
    id "org.openapi.generator" version "4.2.1"
}


dependencies {
    // Use JUnit test framework
    implementation project(':DimeDiaryDomain')
    implementation project(':Utils')


    implementation 'org.springframework.boot:spring-boot-starter-web'
    implementation 'io.springfox:springfox-swagger-ui:2.9.2'
    implementation 'io.springfox:springfox-swagger2:2.9.2'

    implementation group: 'org.dmfs', name: 'lib-recur', version: '0.12.1'

    implementation 'org.openapitools:jackson-databind-nullable:0.1.0'

    compile 'org.mapstruct:mapstruct:1.3.1.Final'
    implementation 'org.mapstruct:mapstruct:1.3.1.Final'
    annotationProcessor 'org.mapstruct:mapstruct-processor:1.3.1.Final'
    compileOnly 'org.projectlombok:lombok'
    annotationProcessor 'org.projectlombok:lombok'
}


compileJava.dependsOn('openApiGenerate')
processResources.dependsOn('copyFrontend')


sourceSets {
    main {
        java {
            srcDirs "${rootDir}/DimeDiaryRest/openapi/src/main/java", "${rootDir}/DimeDiaryRest/build/generated/sources/annotationProcessor/java/main"
        }
    }

}

task copyFrontend(type: Copy) {
    dependsOn ':frontend:assemble'
    from "${rootDir}/frontend/dist"
    into "${buildDir}/resources/main/public"
}


openApiValidate {
    inputSpec = "${rootDir}/../openapi/schema.yaml".toString()
}

openApiGenerate {
    generatorName = "spring"
    library = "spring-boot"
    inputSpec = "${rootDir}/../openapi/schema.yaml".toString()
    outputDir = "${rootDir}/DimeDiaryRest/openapi".toString()
    systemProperties = [
            modelDocs      : "false",
            models         : "",
            apis           : "",
            supportingFiles: "false"
    ]
    configOptions = [
            useOptional          : "true",
            swaggerDocketConfig  : "false",
            performBeanValidation: "false",
            useBeanValidation    : "false",
            useTags              : "true",
            singleContentTypes   : "true",
            basePackage          : "com.dimediary.openapi.api",
            configPackage        : "com.dimediary.openapi.api",
            title                : rootProject.name,
            java8                : "false",
            dateLibrary          : "java8",
            serializableModel    : "true",
            artifactId           : rootProject.name,
            apiPackage           : "com.dimediary.openapi.api",
            modelPackage         : "com.dimediary.openapi.model",
            invokerPackage       : "com.dimediary.openapi.api",
            interfaceOnly        : "true"
    ]
}